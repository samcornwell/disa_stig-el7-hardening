# Generated by Chef for <%= node['fqdn'] %>.
# Local modifications will be overwritten.
# DO NOT EDIT. CREATED BY CHEF COOKBOOK - stig::rsyslog_client
# CHANGES WILL BE OVERWRITTEN BY CHEF
#
# See https://github.com/USGS-CIDA/stig/blob/master/templates/default/etc_rsyslog.conf.erb

# rsyslog v5 configuration file

# For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html
# If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html

#### MODULES ####

$ModLoad imuxsock # provides support for local system logging (e.g. via logger command)
$SystemLogRateLimitInterval 5
$SystemLogRateLimitBurst 5000

$ModLoad imklog   # provides kernel logging support (previously done by rklogd)
#$ModLoad immark  # provides --MARK-- message capability

# Provides UDP syslog reception
#$ModLoad imudp
#$UDPServerRun <%= @server_port %>

# Provides TCP syslog reception
$ModLoad imtcp
$InputTCPServerRun <%= @server_port %>

#### GLOBAL DIRECTIVES ####

# Use default timestamp format
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# File syncing capability is disabled by default. This feature is usually not required,
# not useful and an extreme performance hit
#$ActionFileEnableSync on

# Include all config files in /etc/rsyslog.d/
$IncludeConfig /etc/rsyslog.d/*.conf

#### RULES ####
<%= @rsyslog_rules.join("\n") %>

# ### begin forwarding rule ###
# The statement between the begin ... end define a SINGLE forwarding
# rule. They belong together, do NOT split them. If you create multiple
# forwarding rules, duplicate the whole block!
# Remote Logging (we use TCP for reliable delivery)
#
# An on-disk queue is created for this action. If the remote host is
# down, messages are spooled to disk and sent when it is up again.

<%= @rsyslog_queue_rules.join("\n") %>


<% if @encrypt_traffic == '1' -%>
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/pki/rsyslog/ca.pem
$ActionSendStreamDriverMode 1
<% else -%>
$ActionSendStreamDriverMode 0
<% end -%>

$ActionSendStreamDriverAuthMode anon
*.* @@(o)<%=@server_name%>:<%=@server_port%>

# remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional
#*.* @@LogServer:514
# ### end of the forwarding rule ###
#
